<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE project>

<project name="tfg" default="all" basedir=".">

	<property file="build.properties" />

	<property name="dist.home" value="${basedir}/dist" />
	<property name="build.home" value="${basedir}/build" />
	<property name="buildApp.home" value="${basedir}/${ant.project.name}/${ant.project.name}War/build" />
	<property name="war.home" value="${basedir}/${ant.project.name}/${ant.project.name}War" />
	<property name="webapp.home" value="${basedir}/web/WEB-INF" />
	<property name="src.home" value="./src" />

	<property name="srv.lib" value="${oc4j.lib}\lib\" />
	<property name="cmn.lib" value="${oc4j.lib}\modules\" />

	<property name="compile.debug" value="true" />
	<property name="compile.deprecation" value="false" />
	<property name="compile.optimize" value="true" />

	<path id="classpath.ref">
		<pathelement path="${classpath}" />
		<fileset dir="./lib">
			<include name="*.jar" />
		</fileset>
		<fileset dir="${srv.lib}">
			<include name="*.jar" />
		</fileset>
		<fileset dir="${cmn.lib}">
			<include name="*.jar" />
		</fileset>
	</path>

	<path id="base.path">
		<pathelement path="${classpath}" />
		<fileset dir="lib">
			<include name="**/*.jar" />
		</fileset>
		<pathelement location="classes" />
	</path>


	<!--**************************** LANZAR TODO ***************************** -->
	<target name="all">
		<ant target="borrar" />
		<ant target="directorios" />
		<ant target="compile" />
		<ant target="copiar_war" />
		<ant target="j2ee-ear" />
		<!-- <ant target="javadoc" /> -->
		<ant target="borrar_temp" />
	</target>

	<target name="borrar">
		<delete dir="${build.home}" />
		<delete dir="${project.basedir}/lib" />
	</target>
	<!--***** Elimina los directorios temporales utilizados para la generacion 
		del EAR ***** -->
	<target name="borrar_temp">
		<delete dir="${build.home}/${ant.project.name}War" />
		<delete dir="${build.home}/META-INF" />
		<delete dir="${build.home}/APP-INF/lib" />
		<delete dir="${build.home}/APP-INF" />
		<delete dir="${build.home}/properties" />
		<!--<delete dir="${build.home}/classes"/> -->
	</target>
	
	<target name="directorios">
		<mkdir dir="${build.home}" />
		<mkdir dir="${build.home}/${ant.project.name}War" />
		<mkdir dir="${build.home}/${ant.project.name}War/WEB-INF" />
		<mkdir dir="${build.home}/${ant.project.name}War/WEB-INF/lib" />
		<mkdir dir="${build.home}/${ant.project.name}War/WEB-INF/classes" />
		<mkdir dir="${build.home}/${ant.project.name}War/WEB-INF/classes/META-INF" />
		<mkdir dir="${build.home}/classes" />
		<mkdir dir="${build.home}/META-INF" />
		<mkdir dir="${build.home}/APP-INF" />
		<mkdir dir="${build.home}/APP-INF/lib" />
		<mkdir dir="${dist.home}" />	
		<mkdir dir="${dist.home}/properties" />		
	</target>

	<!--************************* Compilar *********************************** -->
	<target name="compile" description="Compile Java sources">
		<!-- Compile Java classes as necessary -->

		<javac srcdir="${src.home}" destdir="${build.home}/classes"
			debug="${compile.debug}" deprecation="${compile.deprecation}"
			optimize="${compile.optimize}" encoding="iso-8859-1" includeantruntime="false">
			<classpath refid="classpath.ref" />
		</javac>

	</target>
		
	 <!--************************** Copiar archivos de proipiedades ************************* -->		
	 <!--************************** Excluimos el archivo de propiedades porque se lee de una ubicación externa ******************** -->			
		<copy todir="${build.home}/${ant.project.name}War/WEB-INF/classes" verbose="true" overwrite="true">
			<fileset dir="${basedir}/src/conf/properties">	
				<!-- Excluimos solo si vamos a leer las propiedades de un aubicación externa -->
				<!--<exclude name="application.yml" />
				<exclude name="logback.xml" /> -->									
			</fileset>	
		</copy>
		
		<copy todir="${build.home}/${ant.project.name}War/WEB-INF/lib" verbose="true"
			overwrite="true">
			<fileset dir="${basedir}/lib">
				<!--<include name="**/*.jar" /> <exclude name="**/*aopalliance-1.0.jar" /> 
					 <exclude name="**/*commons-codec-1.2.jar" /> <exclude name="**/*commons-digester-2.0.jar" />
					 <exclude name="**/*commons-discovery-0.2.jar" /> <exclude name="**/*commons-logging-api-1.1.jar" /> 
					 <exclude name="**/*jta-1.1.jar" /> <exclude name="**/*log4j-1.2.14.jar" />
					 <exclude name="**/*persistence-api-1.0.jar" /> -->
			</fileset>
		</copy>
		<copy todir="${build.home}/${ant.project.name}War/WEB-INF/classes" verbose="true" overwrite="true">
			<fileset dir="${basedir}/web/WEB-INF/classes">
				<include name="i18n/*.properties" />
			</fileset>
		</copy>
		
		<copy file="./web/WEB-INF/weblogic.xml"
			tofile="${build.home}/${ant.project.name}War/WEB-INF/weblogic.xml" />

		<copy todir="${build.home}/${ant.project.name}War" verbose="true"
			overwrite="true">
			<fileset dir="./web"
				excludes="**/tags/**,**/*.properties,**/*.bak,**/log4j-1.2.14.jar" />
		</copy>

	</target>

	<!--*************************** crear javaDocs *************************** -->
	<target name="javadoc">
		<javadoc packagenames="*.*" sourcepath="./src/java"
			destdir="./build/api" encoding="UTF-8">
			<classpath refid="classpath.ref" />
		</javadoc>
	</target>
</project>
